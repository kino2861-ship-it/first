<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>レジ入金計算</title>

    <!-- jQuery（CDN） -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            max-width: 850px;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 6px;
            text-align: center;
        }

        th {
            background: #f0f0f0;
        }

        input[type=number] {
            width: 70px;
            text-align: right;
            font-size: 1em;
            /* スマホの + / - ボタン非表示 */
            -moz-appearance: textfield;
        }

        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        td.auto {
            background: #fafafa;
        }

        input.error {
            background-color: #ffcccc;
        }
    </style>
</head>

<body>
    <h2>レジ入金計算</h2>

    <table>
        <thead>
            <tr>
                <th>金種</th>
                <th>総枚数</th>
                <th>棒金本数</th>
                <th>レジ残枚数</th>
                <th>レジ棒本数</th>
                <th>入金枚数</th>
                <th>入金棒本数</th>
            </tr>
        </thead>
        <tbody id="money-table"></tbody>
        <tfoot>
            <tr>
                <th>合計金額</th>
                <td class="auto" id="allSum" colspan="2">0</td> <!-- 総枚数と棒金本数をまたぐ -->
                <td class="auto" id="regiSum" colspan="2">0</td> <!-- レジ残とレジ棒本数をまたぐ -->
                <td class="auto" id="inSum" colspan="2">0</td> <!-- 入金と入金棒本数をまたぐ -->
            </tr>
            <tr>
                <th>レジ金過不足（26万との差）</th>
                <td colspan="6" class="auto" id="gosa">0</td>
            </tr>
        </tfoot>


        <script>
            const yen = [1, 5, 10, 50, 100, 500, 1000, 2000, 5000, 10000];
            const tbody = $("#money-table");

            // 表の生成
            yen.forEach((value, i) => {
                // 棒金欄をコインだけに出す（1000円未満）
                const hasStick = value < 1000;

                const row = `
    <tr data-index="${i}">
      <th>${value.toLocaleString()}円</th>
      <td><input type="number" class="all" value="0" min="0"></td>
      ${hasStick ? `<td><input type="number" class="allSti" value="0" min="0"></td>` : `<td class="auto">-</td>`}
      <td><input type="number" class="regi" value="0" min="0"></td>
      ${hasStick ? `<td><input type="number" class="regiSti" value="0" min="0"></td>` : `<td class="auto">-</td>`}
      <td class="auto in">0</td>
      <td class="auto inSti">0</td>
    </tr>`;
                tbody.append(row);
            });
            // 入力ごとに再計算
            $("input").on("input", function () {
                //負の値は０に
                if (Number($(this).val()) < 0 || $(this).val() === "") {
                    $(this).val(0);
                }
                calc();
            });

            // Enterキーで「次の行の同じ列」に移動
            $("table").on("keydown", "input", function (e) {
                if (e.key === "Enter") {
                    e.preventDefault();

                    const currentRow = $(this).closest("tr");
                    const currentIndex = currentRow.index();
                    const currentCol = $(this).closest("td").index();

                    const nextRow = currentRow.next("tr");
                    if (nextRow.length > 0) {
                        const nextInput = nextRow.find("td").eq(currentCol - 1).find("input");
                        if (nextInput.length > 0) {
                            nextInput.focus().select();
                        }
                    }
                }
            });

            // 計算処理
            function calc() {
                let allSum = 0, regiSum = 0, inSum = 0;

                $("#money-table tr").each(function () {
                    const i = $(this).data("index");
                    const value = yen[i];

                    const all = Number($(this).find(".all").val());
                    const regi = Number($(this).find(".regi").val());

                    // 紙幣は棒金0固定
                    const allSti = value < 1000 ? Number($(this).find(".allSti").val()) : 0;
                    const regiSti = value < 1000 ? Number($(this).find(".regiSti").val()) : 0;

                    const inVal = all - regi;
                    const inSti = allSti - regiSti;

                    // エラー判定
                    const regiInput = $(this).find(".regi");
                    const regiStiInput = $(this).find(".regiSti");

                    if (regi > all) {
                        regiInput.addClass("error");
                    } else {
                        regiInput.removeClass("error");
                    }

                    if (value < 1000) {
                        if (regiSti > allSti) {
                            regiStiInput.addClass("error");
                        } else {
                            regiStiInput.removeClass("error");
                        }
                    }

                    $(this).find(".in").text(inVal);
                    $(this).find(".inSti").text(inSti);

                    allSum += all * value + allSti * value * 50;
                    regiSum += regi * value + regiSti * value * 50;
                    inSum += inVal * value + inSti * value * 50;
                });

                const gosa = regiSum - 260000;

                $("#allSum").text(allSum.toLocaleString());
                $("#regiSum").text(regiSum.toLocaleString());
                $("#inSum").text(inSum.toLocaleString());
                $("#gosa").text(gosa.toLocaleString());
            }




            calc();
        </script>

</body>

</html>